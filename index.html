<!DOCTYPE html>
<html>
<head>
  <title>Presensi Dosen STIU Darul Qur'an Mulia</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    
    iframe {
      width: 100%;
      height: 100vh;
      border: none;
    }
  </style>

</head>
<body>

<iframe 
  id="tallyframe"
  src=""
  data-tally-embed="fullscreen"
  style="width:100%; height:100vh; border:0; margin:0; padding:0; display:block;"
  loading="lazy">
</iframe>

<script>
document.addEventListener("DOMContentLoaded", () => {
  if (!navigator.geolocation) {
    alert("GPS tidak didukung di perangkat ini.");
    return;
  }

  navigator.geolocation.getCurrentPosition(success, error, {
    enableHighAccuracy: true
  });

  function success(pos) {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    // Step 2: Reverse Geocoding (mengubah lat long jadi alamat)
    const url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const alamat = data.display_name || "Alamat tidak ditemukan";

        // Step 3: Kirim ke Tally
        const tallyURL = `https://tally.so/r/q45a5Y?location=${encodeURIComponent(alamat)}`;
        document.getElementById("tallyframe").src = tallyURL;
      })
      .catch(err => {
        console.log("Reverse geocoding error:", err);
        const fallback = `${lat},${lng}`;
        document.getElementById("tallyframe").src = `https://tally.so/r/q45a5Y?location=${fallback}`;
      });
  }

  function error(err) {
    console.log("GPS error:", err);
    alert("Tidak bisa mendapatkan lokasi. Izinkan akses lokasi.");
  }
});
</script>

</body>
</html>
